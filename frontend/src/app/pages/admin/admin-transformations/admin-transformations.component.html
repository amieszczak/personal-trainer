<div class="admin-transformations">
  <div class="header">
    <button class="back-button" (click)="goBack()">‚Üê Back to Admin Panel</button>
    <h1>Manage Transformations</h1>
    <p class="subtitle">View, edit, and manage client transformations</p>
  </div>

  @if (isLoadingData) {
    <div class="loading-message">
      <p>Loading transformations...</p>
    </div>
  } @else {
    <form [formGroup]="transformationsForm" (ngSubmit)="onSubmit()">
    <div formArrayName="transformations">
      <div 
        *ngFor="let transformation of transformationsArray.controls; let i = index" 
        [formGroupName]="i"
        class="transformation-card"
      >
        <div class="card-header">
          <div>
            <h3>
              @if (transformationsArray.at(i).get('id')?.value) {
                <span class="existing-badge">Existing</span>
                Transformation #{{ transformationsArray.at(i).get('id')?.value }}
              } @else {
                <span class="new-badge">New</span>
                Transformation {{ i + 1 }}
              }
            </h3>
          </div>
          <button 
            type="button" 
            class="remove-button" 
            (click)="removeTransformation(i)"
            [disabled]="isLoading"
          >
            @if (transformationsArray.at(i).get('id')?.value) {
              Delete
            } @else {
              Remove
            }
          </button>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label [for]="'name-' + i">Name <span class="required">*</span></label>
            <input 
              type="text" 
              [id]="'name-' + i"
              formControlName="name"
              placeholder="Enter client name"
            />
            @if (transformationsArray.at(i).get('name')?.invalid && transformationsArray.at(i).get('name')?.touched) {
              <span class="error-text">Name is required</span>
            }
          </div>

          <div class="form-group">
            <label [for]="'age-' + i">Age <span class="required">*</span></label>
            <input 
              type="number" 
              [id]="'age-' + i"
              formControlName="age"
              placeholder="Enter age"
              min="1"
              max="150"
            />
            @if (transformationsArray.at(i).get('age')?.invalid && transformationsArray.at(i).get('age')?.touched) {
              <span class="error-text">Age is required (1-150)</span>
            }
          </div>
        </div>

        <div class="form-group">
          <label [for]="'description-' + i">Description <span class="required">*</span></label>
          <textarea 
            [id]="'description-' + i"
            formControlName="description"
            placeholder="Enter transformation description"
            rows="3"
          ></textarea>
          @if (transformationsArray.at(i).get('description')?.invalid && transformationsArray.at(i).get('description')?.touched) {
            <span class="error-text">Description is required</span>
          }
        </div>

        <div class="form-group">
          <label [for]="'story-' + i">Story <span class="required">*</span></label>
          <textarea 
            [id]="'story-' + i"
            formControlName="story"
            placeholder="Enter client transformation story"
            rows="4"
          ></textarea>
          @if (transformationsArray.at(i).get('story')?.invalid && transformationsArray.at(i).get('story')?.touched) {
            <span class="error-text">Story is required</span>
          }
        </div>

        <div class="form-group">
          <label [for]="'quote-' + i">Quote <span class="required">*</span></label>
          <textarea 
            [id]="'quote-' + i"
            formControlName="quote"
            placeholder="Enter client quote"
            rows="2"
          ></textarea>
          @if (transformationsArray.at(i).get('quote')?.invalid && transformationsArray.at(i).get('quote')?.touched) {
            <span class="error-text">Quote is required</span>
          }
        </div>

        <div class="form-group">
          <label [for]="'image-' + i">Image URL (optional)</label>
          <input 
            type="text" 
            [id]="'image-' + i"
            formControlName="image"
            placeholder="Enter image URL or path"
          />
        </div>
      </div>
    </div>

    <div class="actions">
      <button type="button" class="add-button" (click)="addTransformation()">
        + Add Another Transformation
      </button>
    </div>

    @if (successMessage) {
      <div class="success-message">
        {{ successMessage }}
      </div>
    }

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }

    <div class="submit-section">
      <button 
        type="submit" 
        class="submit-button"
        [disabled]="!transformationsForm.valid || isLoading || isLoadingData"
      >
        @if (isLoading) {
          <span>Saving...</span>
        } @else {
          <span>Save All Changes</span>
        }
      </button>
    </div>
  </form>
  }
</div>
